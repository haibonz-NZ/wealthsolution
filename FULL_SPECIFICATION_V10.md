# 跨国家族办公室全球资产规划智能报告系统 - 全案开发规格书 (V10.0)

**版本**：V10.0 (The Definitive Edition)
**密级**：核心机密
**适用对象**：产品经理、全栈开发工程师、UI/UX 设计师、测试工程师
**文档来源**：基于《跨境财富智能AI 顾问助手系统开发需求（基础版）》及《全球财富风险自查系统 (GWRC)》

---

# 📖 第一章：产品愿景与核心战略

## 1.1 产品定义
本系统不是一个简单的“自动填表工具”，而是一个**“顾问生产力引擎 (Advisor Productivity Engine)”**。
它分为两个完全独立的端：
1.  **客户端 (Client-Facing, C端)**：一个极简、匿名、视觉震撼的“财富体检机”。它的任务是**“吓唬客户”**（通过揭示风险）并收集销售线索。
2.  **顾问端 (Advisor-Facing, B端)**：一个专业、深度、可控的“数字化大脑”。它的任务是**“赋能顾问”**，辅助面谈，生成一份让客户无法拒绝的深度规划方案。

## 1.2 三大设计铁律
1.  **隐私保障 (Privacy)**：C端全流程匿名，无痕Session，不存库。B端通过“访问密码”鉴权，保护客户数据。
2.  **感官震慑 (Sensory Awe)**：C端必须“炫”，用雷达图、红绿灯、损益条把抽象的法律风险具象化。
3.  **价值留白 (Value Gap)**：C端只诊断（红灯），不开药（方案）。B端提供初步方案，但保留核心落地细节，迫使客户付费。

---

# 🗺️ 第二章：用户旅程 (User Journey Map)

## 2.1 旅程一：C端客户自查 (The Hook)
1.  **入口**：客户点击顾问分享的链接 `https://client_wealthsolution.theonefo.com/?advisor_id=123`。
2.  **门厅**：看到“全球财富风险自查系统”，被“AES-256加密”和“匿名访问”安抚，点击“立即体检”。
3.  **录入**：
    *   **身份**：拖拽“子女”头像到“美国”地图 -> 触发“美国身份判定弹窗” -> 回答“绿卡/居住天数”。
    *   **资产**：拖拽“房产”图标到“中国”地图 -> 勾选“1000万-5000万”。
    *   **痛点**：多选“税务合规”、“二代传承”。
4.  **诊断**：
    *   看到**雷达图**迅速收缩（健康度下降）。
    *   看到**风险红绿灯**亮起（如：🔴 美籍身份持有非美基金）。
    *   看到**损益模拟器**红条增长（“您的财富预计缩水 40%”）。
5.  **转化**：
    *   尝试点击“一键修复” -> 视觉变绿（爽感）。
    *   点击“获取完整方案” -> 弹出手机号输入框 -> 提交。

## 2.2 旅程二：B端顾问跟进 (The Deal)
1.  **接收**：顾问在后台 Dashboard 看到“新线索：138xxxx (高危)”。
2.  **导入**：点击“转为正式案例”，数据自动填充进 B 端系统。
3.  **完善**：顾问补充细节（如具体的信托架构、保单现金价值）。
4.  **生成**：点击“生成报告” -> DeepSeek 思考 -> 输出 JSON。
5.  **修订**：顾问使用**在线编辑器**微调措辞，点击“小灯泡”查看法条解释。
6.  **交付**：导出 PDF，约客户见面。

---

# ⚙️ 第三章：功能模块详细规格 (Functional Specs)

## 3.1 模块 A：身份锚点与地图交互 (C端/B端共用)
**核心逻辑**：通过“人”与“地”的结合，自动触发税务判定。

### A.1 地图区域定义
系统需硬编码支持以下 8 大核心管辖区（热区）：
*   `CN` (中国大陆)
*   `HK` (中国香港)
*   `US` (美国)
*   `UK` (英国)
*   `CA` (加拿大)
*   `AU` (澳大利亚)
*   `SG` (新加坡)
*   `JP` (日本)

### A.2 角色定义
*   `Self` (本人), `Spouse` (配偶), `Child` (子女), `Parent` (父母), `Grandchild` (孙辈)。

### A.3 触发逻辑 (Trigger Logic)
当 `Role` 拖入 `Region` 时，触发特定的**“微型问卷”**：

#### **场景：美国 (USA) —— 全球征税判定**
*   **Q1**: 持有护照/绿卡？ (Yes -> 🔴 `US_TAX_PERSON`)
*   **Q2**: 过去3年居住满183天？ (Yes -> 🔴 `SUBSTANTIAL_PRESENCE`)
*   **Q3**: 是否计划弃籍？ (Yes -> 🟡 `EXIT_TAX_RISK`)

#### **场景：澳大利亚 (AU) —— 税务居民判定**
*   **Q1**: 是否持有 PR 或公民身份？ (Yes -> 🟢 `AU_RESIDENT`)
*   **Q2**: 是否持有 188/临时签证？ (Yes -> 🟢 `AU_TEMP_RESIDENT` - **利好：海外收入免税**)
*   **Q3**: 是否计划未来长期离开澳洲？ (Yes -> 🔴 `AU_DEPARTURE_TAX` - **高危：视同售出**)

#### **场景：日本 (JP) —— 继承税判定**
*   **Q1**: 居住是否超过 10 年？ (Yes -> 🔴 `JP_UNLIMITED_LIABILITY` - **高危：全球资产继承税**)
*   **Q2**: 是否持有“高度人才签证”？ (Yes -> 🟡 `JP_SPECIAL_VISA`)

---

## 3.2 模块 B：资产配置与架构扫描 (Structure Scan)

### B.1 资产类型与风险
*   `Real Estate` (房产):
    *   **风险点**：流动性差、无法隐蔽、属地继承法（如 US/UK 房产需在此地遗嘱认证）。
*   `Insurance` (保单):
    *   **风险点**：美国 `IRC 7702` 合规性（不达标则视为投资账户征税）。
*   `Trust` (信托):
    *   **风险点**：美国 `3520/3520A` 申报（漏报罚款 35%）。
    *   **风险点**：澳洲 `Section 99B`（历史收益分配征税 47%）。
*   `Company` (股权):
    *   **风险点**：`CFC` (受控外国企业) 穿透规则。

---

## 3.3 模块 C：损益模拟器算法 (The Calculator)

*前端需实现以下数学模型，用于动态绘制进度条。*

### C.1 遗产税损耗 (Inheritance Tax Erosion)
*   **公式**：
    $$ Loss = \sum (Asset\_Value_{region} \times Rate_{region}) $$
*   **参数表**：
    *   `US`: 40% (免税额 $60k 对于非美籍)
    *   `UK`: 40% (免税额 £325k)
    *   `JP`: 10% - 55% (累进税率)
    *   `CN`: 0% (目前)

### C.2 离境税损耗 (Departure Tax / Exit Tax)
*   **适用**：CA (加拿大), AU (澳大利亚)
*   **公式**：
    $$ Loss = (Asset\_Market\_Value - Cost\_Base) \times Capital\_Gains\_Rate $$
    *   *假设*：增值部分占 50%，税率 25%。
    *   *简化算法*：总资产 * 12.5%。

### C.3 行政摩擦成本 (Probate & Legal)
*   **适用**：跨国无遗嘱继承。
*   **公式**：总资产 * 3% - 5% (律师费 + 公证费 + 资产冻结折价)。

---

## 3.4 模块 D：报告生成引擎 (DeepSeek Integration)

### D.1 Prompt Engineering (提示词工程)
后端不应只发一句话，而应构建一个**结构化 Prompt**：

```text
你是一位拥有20年经验的家族办公室架构师。
客户画像：
- 身份：[JSON.identities]
- 资产：[JSON.assets]
- 风险标签：[R1, R2, R5...] (由规则引擎计算得出)

请生成一份《家族财富诊断报告》，严格遵守以下 JSON 格式：
{
  "summary": "...",
  "risk_deep_dive": [
    { "title": "...", "content": "...", "severity": "high" }
  ],
  "solutions": {
    "short_term": "...",
    "long_term": "..."
  }
}

写作要求：
1. 语气：[tone] (激进/稳健)
2. 必须引用法条：针对 R1 风险，引用 IRC Sec 7701(b)。
3. 绝对不要给出具体的开户行名称，只说“国际一级托管行”。
```

### D.2 错误处理与降级
*   **超时处理**：如果 DeepSeek 30秒未响应，前端显示“正在进行深度法律检索...”，避免焦虑。
*   **格式错误**：如果返回的不是 JSON，后端自动进行正则提取或重试。

---

# 💻 第四章：技术栈与开发规范

## 4.1 前端 (Frontend)
*   **框架**：React 19 + Vite
*   **UI 库**：Tailwind CSS v4 + Shadcn/UI
*   **动画**：Framer Motion (必须大量使用，如数字滚动、进度条增长)
*   **图表**：Recharts (雷达图)
*   **编辑器**：TipTap (用于 B 端报告修改)
*   **拖拽**：dnd-kit

## 4.2 后端 (Backend - Serverless)
*   **平台**：Cloudflare Pages Functions
*   **语言**：Node.js / JavaScript
*   **API**：DeepSeek V3 (OpenAI Compatible)
*   **鉴权**：Bearer Token + Access Code

## 4.3 数据库 (LocalStorage + JSON)
*   **策略**：为了极致隐私，**不使用 SQL 数据库**。
*   **存储**：
    *   所有客户数据存储在浏览器 `localStorage`。
    *   导出/导入使用 JSON 文件。
    *   *仅在“留资”一瞬间，将手机号发送到飞书/钉钉 webhook（可选）。*

---

# 📅 第五章：开发任务清单 (WBS)

## Phase 1: 核心诊断与可视化 (Week 1)
*   [ ] **F1.1** 实现 `USAssessment.tsx` (美国问卷) - *已完成*
*   [ ] **F1.2** 开发 `AUAssessment.tsx` (澳洲问卷) - *待开发*
*   [ ] **F1.3** 开发 `CNAssessment.tsx` (加拿大问卷) - *待开发*
*   [ ] **F1.4** 完善 `RiskEngine.ts`：将问卷结果转化为风险标签 (`RiskTags`)。
*   [ ] **F1.5** 升级 `LossSimulator`：支持多国混合计算逻辑。

## Phase 2: 报告编辑器与 AI 接入 (Week 2)
*   [ ] **F2.1** 集成 `TipTap` 编辑器到报告页面。
*   [ ] **F2.2** 后端 `generate.js` 改造：支持 JSON 模式输出。
*   [ ] **F2.3** 开发“小灯泡” RAG 知识库前端组件。

## Phase 3: B端数据流转 (Week 3)
*   [ ] **F3.1** 开发“一键导入”功能：将 C 端生成的 JSON 导入 B 端。
*   [ ] **F3.2** B 端 Dashboard 增加“线索管理”面板。

## Phase 4: 视觉打磨 (Week 4)
*   [ ] **F4.1** 统一全站字体为衬线体 (Cinzel / Noto Serif)。
*   [ ] **F4.2** 增加“打印模式” CSS，确保 PDF 导出美观。

---

**文档结束**
这份文档详细定义了 GWRC 系统的每一个毛孔。建议开发团队以此为基准，逐个模块进行“填空式”开发。
