# 智能报告系统优化与导出增强方案 (V2)

**日期**：2026-01-11  
**主题**：针对用户反馈的报告内容细化、格式调整及导出功能升级方案

---

## 1. 📋 核心内容修改需求

根据您的指示，我们将对报告的展示维度进行以下**精细化调整**：

### 1.1 家族成员表格 (Family Members)
*   **调整**：增加并固化列展示。
*   **新表头**：`姓名` | `关系` | `年龄` | `健康状况` | `国籍`
*   **移除**：原有的“身份备注”列，将其信息融合或移除，使表格更专注。

### 1.2 资产状况板块 (Asset Analysis) —— **重大重构**
*   **数据可视化 (KPI Cards)**：
    *   不再只显示总数，改为**三卡片布局**：
        1.  **国内资产**：显示 USD 总额 + **CNY 估算值** (按 7.2 汇率)。
        2.  **国外资产**：显示 USD 总额。
        3.  **总资产**：显示 USD 总额。
    *   **图表**：仅保留 **“资产类别分布”** 饼图（您提到的“下面两个图”优化为专注类别分布）。
*   **双资产清单**：
    *   拆分为两个独立表格：**【国内资产列表】** 和 **【国外资产列表】**。
    *   **新表头**：`资产信息` (名称+类别) | `持有人` | `原值` | `现值`。
    *   **逻辑**：每一行清晰展示该资产的增值/折旧情况。

### 1.3 痛点分析与版本管理
*   **痛点深化**：优化 AI 指令，要求在分析风险时增加“法律依据”或“案例类比”，使内容更详实。
*   **版本保存**：在报告页右上角新增 **“保存当前版本”** 按钮，记录每一次生成的快照，方便回溯。

---

## 2. 🖨️ 打印与导出痛点攻坚方案

针对您提到的“打印格式乱、分页截断”以及“Word 导出”需求，专家组提出以下技术解决方案：

### 2.1 PDF 打印/导出优化 (样式防崩坏)
目前打印乱的主要原因是浏览器默认的分页逻辑切断了组件。
*   **解决方案**：引入**智能分页 CSS 策略**。
    *   `break-inside: avoid`：强制要求**图表、家族树、表格**必须在同一页显示，**绝不从中间切断**。如果当前页放不下，自动挤到下一页。
    *   `break-before: page`：强制让“资产板块”、“痛点板块”等大章节**自动另起一页**，保证版面整洁。
    *   **页眉页脚**：在每一页 PDF 底部自动添加“Wealth Solution 家族办公室”水印和页码。

### 2.2 Word 导出方案 (Docx) —— **可行性分析**
您问“能不能做到直接导进 Word”，答案是：**可以，但有技术代价**。

*   **技术挑战**：网页是 HTML，Word 是 XML。网页上的**家族树 (Family Tree)** 和 **资产图表 (Pie Chart)** 是代码画的，Word 不认识代码。
*   **实现方案 (Hybrid Export)**：
    1.  **文字与表格**：使用 `docx` 专业库，将网页上的文字和表格**原生重绘**为 Word 格式。这意味着导出的 Word 里，**文字是可以编辑的，表格是可以拉伸的**（完美符合您的要求）。
    2.  **图表与图谱**：
        *   系统会在后台自动将 Family Tree 和 饼图 **瞬间截图**。
        *   然后将这两张图片**贴**进 Word 文档对应的位置。
*   **最终效果**：您将得到一个 `.docx` 文件，打开后：
    *   摘要、痛点、总结、表格 —— **可编辑文本**。
    *   家族树、饼图 —— **高清图片**。
    *   排版 —— 即使跨页也不会变形，因为 Word 会自动处理图片排版。

---

## 3. 📅 执行计划

如果您认可上述方案，我将按以下顺序开发：

1.  **Phase 1 (内容重构)**：
    *   修改 `MemberTable` 和 `AssetAnalysis` 组件，落实字段调整和双币种显示。
    *   升级 `ReportService` 适配新的 Prompt。
2.  **Phase 2 (PDF 修复)**：
    *   编写深度打印 CSS，解决分页截断问题。
3.  **Phase 3 (Word 引擎)**：
    *   引入 `docx` 和 `html2canvas` 库。
    *   编写一个**“Word 生成器”**，把网页内容“翻译”成 Word 文档。

**请确认：是否同意先进行 Phase 1 和 Phase 2 的开发？Word 导出功能 (Phase 3) 稍复杂，可以作为第二步迭代加入。**
