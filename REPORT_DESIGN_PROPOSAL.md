# 智能报告生成架构设计方案：专家委员会研讨纪要

**日期**：2026-01-11  
**主题**：Wealth Solution 家族财富报告系统的可视化与渲染架构选型  
**目标**：实现一份兼具“专业深度”与“视觉美感”的交付级报告，包含执行摘要、家族图谱、资产饼图及详细清单。

---

## 🏛️ 背景与需求分析

客户希望生成的报告不再是单一的 Markdown 文本流，而是一个结构严谨、图文并茂的“产品级”交付物。核心诉求包括：
1.  **Executive Summary**：AI 生成的深度摘要。
2.  **Family Structure**：结构化列表 + 可视化 Family Tree 图谱。
3.  **Financial Overview**：数据可视化（饼图/柱状图）+ 详细资产清单。
4.  **Format**：排版精美，可渲染，可阅读。

---

## 💡 方案选项研讨 (Options)

经过技术、产品与设计专家的联合评估，我们梳理出以下三种实现路径：

### 方案 A：智能模块化组装 (Smart Modular Assembly) [推荐]

**核心理念**：**“各司其职，乐高式拼接”**。将报告页面视为一个由多个 React 组件（积木）组成的容器。AI 负责填充文本积木，代码逻辑负责填充图表积木。

*   **架构逻辑**：
    *   页面被硬编码为一个标准的“报告骨架” (Skeleton)。
    *   **Slot 1 (Summary)**: 调用 AI 生成纯文本摘要，填入文本框。
    *   **Slot 2 (Family)**: 直接复用 `FamilyTree` 组件，数据源来自 `MemberService`。
    *   **Slot 3 (Charts)**: 使用 `Recharts` 库，读取 `AssetService` 数据渲染动态饼图。
    *   **Slot 4 (List)**: 使用 Ant Design 的 `Table` 组件展示资产明细。
*   **优势 (Pros)**：
    *   ✅ **视觉完美**：图表和图谱都是原生代码渲染，清晰度极高，交互性好。
    *   ✅ **稳定性强**：不会出现 AI 画图画歪了、表格对不齐的问题。
    *   ✅ **复用性**：直接复用现有的 Family Tree 组件，无需重新开发。
    *   ✅ **所见即所得**：网页上看到的样子就是最终样子，支持一键打印 PDF。
*   **劣势 (Cons)**：
    *   结构相对固定：如果想要“先展示资产，再展示家庭”，需要改代码（灵活性略低）。

### 方案 B：AI 原生流式 UI (Generative UI / Vercel AI SDK)

**核心理念**：**“AI 决定一切”**。AI 不仅生成文字，还生成界面描述代码（如 JSON），前端根据 JSON 动态渲染组件。

*   **架构逻辑**：
    *   Prompt 告诉 AI：“请返回一个 JSON，包含 `type: 'chart'` 和 `data: [...]`”。
    *   前端编写一个通用的渲染引擎，根据 AI 返回的类型渲染不同组件。
*   **优势 (Pros)**：
    *   ✨ **极度灵活**：AI 可以决定“这里需要一个饼图”或者“这里需要一个警告框”，报告结构千人千面。
    *   ✨ **未来感**：最前沿的技术体验。
*   **劣势 (Cons)**：
    *   ❌ **不可控**：AI 可能会产生幻觉（例如返回了错误的数据格式），导致页面白屏。
    *   ❌ **开发成本高**：需要编写复杂的渲染器和容错逻辑。
    *   ❌ **样式统一难**：难以保证每次生成的视觉风格完全一致。

### 方案 C：静态排版引擎 (Print-First / PDF Generation)

**核心理念**：**“像排版报纸一样生成”**。放弃网页的交互性，专注于生成一张静态的长图或 PDF。

*   **架构逻辑**：
    *   使用 `react-pdf` 或 `puppeteer` 在后台生成 PDF 文件。
    *   用户点击生成后，直接下载一个 PDF，而不是在网页上看。
*   **优势 (Pros)**：
    *   📄 **交付感强**：直接拿到 PDF 文件，适合发邮件。
    *   📄 **格式绝对固定**：不用担心不同浏览器显示效果不一样。
*   **劣势 (Cons)**：
    *   ❌ **无交互**：图表点不了，图谱不能缩放。
    *   ❌ **体验断层**：用户无法在线快速预览或微调内容。

---

## 🏆 专家委员会最终建议

我们一致推荐采用 **方案 A：智能模块化组装 (Smart Modular Assembly)**，并辅以 **CSS 打印优化**。

### 理由：
1.  **扬长避短**：AI 擅长写分析（Summary/Risk），但不擅长画精确的图表（Charts/Tree）。代码擅长画图表，但不擅长写分析。**混合使用是最佳实践**。
2.  **落地最快**：您现有的 `FamilyTree` 组件已经非常完美，直接嵌入报告页面即可，无需 AI 重新生成一遍图片。
3.  **兼顾导出**：我们可以通过 CSS 的 `@media print` 样式，让这个网页在点击“打印/另存为 PDF”时，自动变成一份排版完美的 A4 纸质报告（隐藏按钮、导航栏，调整边距）。

### 📅 下一步行动计划 (Action Plan)

1.  **重构 `ReportSectionViewer`**：将其改造为“混合渲染引擎”。
2.  **引入图表库**：安装 `recharts`，用于绘制资产饼图。
3.  **组件拼装**：
    *   顶部：`AI Summary` (Markdown)
    *   中部：`Family Stats` (Table) + `Family Tree` (Component)
    *   底部：`Asset Charts` (Pie) + `Asset List` (Table)
4.  **打印适配**：添加打印样式，确保导出 PDF 时美观。

---
*Wealth Solution Technical Committee*
